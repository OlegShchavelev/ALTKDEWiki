---
title: Distrobox
aggregation:
  sisyphus: distrobox
appstream:
  name: Distrobox
  icon: ./img/distrobox-logo.png
  summary: Программа для запуска различных дистрибутивов Linux внутри вашего.
  developer:
    name: Luca Di Maio
    nickname: 89luca89
  metadata_license:
    name: GNU GPLv3
    link: https://choosealicense.com/licenses/gpl-3.0/
  url:
    homepage: https://distrobox.it/
    bugtracker: https://github.com/89luca89/distrobox/issues
    help: https://github.com/89luca89/distrobox
---

# Distrobox

Distrobox - это инструмент, который позволяет запускать различные дистрибутивы Linux внутри вашего основного (хост) дистрибутива. Рассматриваемый софт основан на технологии контейнеризации, но, несмотря на это, дистрибутивы тесно интегрируются в вашу систему. Поэтому программы, установленные внутри них, имеют доступ к вашей файловой системе, USB-устройствам, аудио и видео (X11/Wayland) системам.

![Скриншот программы Distrobox](./img/distrobox-screen.png 'Скриншот программы Distrobox')

## Установка из репозитория

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install distrobox
```

```shell[epm]
epm -i distrobox
```

:::

::: info Объяснение
Можно использовать как Docker так и Podman, но рекомендуется использовать Podman вместо Docker, поскольку по умолчанию Docker будет запускать контейнеры как root, а корневые контейнеры будут иметь неограниченный доступ к файловой системе вашего хоста.
:::

## Предварительная настройка

Сформируйте конфигурационный файл

```shell
touch ~/.distroboxrc
```

Откройте с помощью

```shell
nano ~/.distroboxrc
```

Добавьте содержимое:
```shell
container_always_pull="0"
container_manager="podman"
```

::: info Объяснение
container_manager - podman/docker. Определяем, какая система контейнеризации будет использоваться для управления контейнерами.
:::

### Установка Podman

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install podman
```

```shell[epm]
epm -i podman
```

:::

Добавляем правила в UID и GID:

```shell
su - -c "echo "$USER:524288:65536" | tee -a /etc/subuid /etc/subgid"
```

::: info Объяснение
Эти файлы используются для настройки UID (User ID) и GID (Group ID) мэппинга, который необходим для работы изолированных rootless-контейнеров (контейнеров, работающих без привилегий root)
:::

Выдаем права:

```shell
su - -c "chmod u+s /usr/bin/newuidmap /usr/bin/newgidmap"
su - -c "chmod a+x /usr/bin/newuidmap /usr/bin/newgidmap"
```

::: info Объяснение
Настройки прав доступа к утилитам newuidmap и newgidmap, они нужны для работы rootless-контейнеров.
:::

Для применения всех наших изменений в конфигурации, связанных с пространствами имён пользователей, выполним:

```shell
podman system migrate
```

### Установка Docker

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install docker-engine
```

```shell[epm]
epm -i docker-engine
```

:::

Добавляем своего пользователя в группу docker:

```shell
su - -c "/sbin/usermod -aG docker $USER"
```

Затем:

```shell
su - -c "systemctl enable --now docker"
```

::: warning Важно
Необходимо перезагрузить компьютер что-бы появился доступ к службе docker
:::

::: info Объяснение
Таким образом, мы добавили пользователя в группу `docker`, а также запустили сервисы Docker, необходимые для его работы.

Чтобы убедиться в том, что пользователь действительно добавлен в указанную группу, выполните команду `groups $USER`.
:::

::: tip
Если по какой-то причине `$USER` не подставил активного пользователя при выполнении команды уберите это и впишите нужного пользователя вручную.
:::

## Управление программой

Теперь, завершив предварительные настройки, можно приступать к использованию Distrobox. Для начала следует определиться с тем, какой дистрибутив будем устанавливать.

Посмотреть полный список поддерживаемых систем можно по этой [ссылке](https://distrobox.it/compatibility/#containers-distros).

В статье же будет рассмотрена работа программы на примере [Fedora Linux](https://fedoraproject.org/ru/workstation/).

::: warning Важно
Учтите, что все дистрибутивы, установленные при помощи Distrobox, не будут иметь графического окружения!

Пользователю будет доступна полноценная ОС, но только в консольном виде и с некоторыми особенностями от рассматриваемой программы!
:::

### Установка дистрибутива

Для того чтобы создать контейнер с выбранным дистрибутивом (в данном случае Fedora Linux), выполните команду ниже:

::: code-group

```shell[1 способ]
distrobox create --image fedora:latest --name fedora
```

```shell[2 способ]
distrobox-create --image fedora:latest --name fedora
```

::: info Объяснение
`--image` или `-i` нужны для выбора устанавливаемой системы.

Параметр `fedora:latest` для вышеуказанной опции состоит из двух частей, разделенных символом двоеточия. Первая часть отвечает за выбранный к установке дистрибутив. Вторая часть указывает на его версию. Это обозначает, что можно выбрать как конкретную версию (например, для Fedora Linux - это 38, 39...) или последнюю из доступных в Distrobox (latest).

`--name` или `-n` используются для указания названия контейнера. При отсутствии данной опции будет применено название "по умолчанию".

**Помимо вышеописанных "флагов" существуют и некоторые другие. Например:**

`--nvidia` интегрирует поддержку проприетарных драйверов для видеокарт Nvidia, если они были заранее установлены в хост системе.

Имейте в виду, что для работы параметра требуются современные дистрибутивы с `glibc` (GNU LibC) в качестве **хост** системы! Проверить это можно, выполнив `ldd --version`.

Если что, ALT Linux подходит под выставленные требования, даже несмотря на то, что его нет в официальном списке протестированных систем.

`--yes` или `-Y` используется для автоматического извлечения систем без ручного подтверждения.
:::

На данный момент в вашем распоряжении будет только контейнер без самой системы.

Её установка произойдет при первом входе в него.

Подробнее об этом поговорим в блоке ниже.

### Вход в дистрибутив

Теперь в терминале появится одна из команд ниже для входа в систему:

```shell[1 способ]
distrobox enter fedora
```

::: tip
Замените `fedora` на название нужного контейнера.

Чтобы выйти из дистрибутива, используйте команду `exit` или сочетание клавиш [[Ctrl]] + [[d]].
:::

::: warning
Установка ОС не закончится автоматически в случае использования Docker! В конце процесса потребуется ввести пароль для созданного внутри контейнера пользователя.

Данный пароль потребуется, например, при использовании `sudo`.
:::

### Запуск команд из хоста

Находясь в контейнерном дистрибутиве, вы не будете иметь доступа к программам, установленным в вашей основной системе.

Однако если вам нужно запустить какую-либо команду оттуда, не выходя из контейнера, следует использовать следующую команду:

```shell
distrobox-host-exec flatpak run org.mozilla.firefox
```

::: tip
Замените `flatpak run org.mozilla.firefox` на нужную команду, выполняемую на основной системе.
:::

### Отображение установленных дистрибутивов

::: tabs

==1 способ

::: code-group

```shell[стандарт]
distrobox list
```

```shell[сокращение]
distrobox ls
```

== 2 способ

```shell
ditrobox-list
```

:::

::: tip
Если строка окрашена в зеленый цвет, то это значит, что контейнер работает.

Если строка окрашена в оранжевый цвет, то это значит, что контейнер выключен.
:::

### Управление ярлыками контейнеров

После установки системы на вашем хосте автоматически появится ярлык для его быстрого запуска. Однако этим можно управлять вручную.

**Удалить ярлык из системы:**

```shell
distrobox generate-entry fedora --delete
```

**Установить/Вернуть ярлык в систему:**

```shell
distrobox generate-entry fedora
```

::: tip
Во всех командах не забудьте заменить `fedora` на название нужного контейнера.
:::

::: info Объяснение
`--delete` или `-d` отвечают за удаление ярлыка

`--all` или `-a` позволяют выполнять команду для всех дистрибутивов

`--icon` или `-i` устанавливают собственную иконку для ярлыка.

Не забудьте указать **абсолютный** путь до неё!
:::

### Обновление дистрибутивов

Конечно, вы можете использовать пакетный менеджер дистрибутива для обновления системы.

Однако данный способ позволяет обновить несколько ОС одновременно, не подстраиваясь под их синтаксис!

```shell
su - -c "distrobox-upgrade fedora"
```

::: tip
Замените `fedora` на название нужного контейнера или укажите список из них для обновления.

Также вместо списка можно использовать опцию `--all` или `-a` для обновления всех установленных систем.

Для обновления только запущенных ОС существует параметр `--running`.

Используя `--all` и `--running` в одной команде вы обновите все **запущенные** контейнеры!
:::

### Остановка работающих дистрибутивов

Контейнеры в Distrobox остаются включенными даже после выхода из них, за счет чего последующие входы происходят очень быстро.

Поэтому, если вам требуется остановить работу какого-либо контейнера, используйте одну из этих команд:

::: code-group

```shell[1 способ]
distrobox stop fedora
```

```shell[2 способ]
distrobox-stop fedora
```

:::

::: tip
Замените `fedora` на название нужного контейнера или на список нужных.

Для остановки без подтверждения применяются параметры `--yes` или `-Y`.

А при помощи опции `--all` или `-a` можно остановить все активные системы.
:::

### Удаление дистрибутивов

Если какой-то из дистрибутивов вам больше не нужен, остановите его, как в инструкции выше, и удалите следующим образом:

::: code-group

```shell[1 способ]
distrobox rm fedora
```

```shell[2 способ]
distrobox-rm fedora
```

:::

::: tip
Замените `fedora` на название нужного контейнера.

А если вы его забыли, воспользуйтесь встроенной в Distrobox [командой](#отображение-установленных-дистрибутивов), которую мы рассматривали выше.

Для удаления всех контейнерных дистрибутивов используйте флаг `--all` или `-a`.

Для принудительного удаления существуют параметры `--force` или `-f`.
:::

### Вынос программ из дистрибутивов в хост систему

Наконец мы добрались до самой интересной части этой статьи: использование программ из контейнеров так, будто бы они установлены в основной системе!

Для этого необходимо всего лишь установить нужный пакет и выполнить указанную команду, находясь **внутри** контейнерной ОС:

```shell
distrobox-export --app telegram-desktop
```

::: tip
Замените `telegram-desktop` на нужную программу.
:::

::: warning
Учтите, что в стандартных репозиториях Fedora Linux приложение `telegram-desktop` отсутствует.

Чтобы получить возможность его установить, добавьте репозиторий [**RPM Fusion**](https://docs.fedoraproject.org/en-US/quick-docs/rpmfusion-setup/) в данный дистрибутив.

После этого вы получите доступ ко многим другим отсутствующим пакетам.
:::

::: info Объяснение
`--app` или `-a` передают название программы или абсолютный путь до её `.desktop` файла, чтобы добавить ярлык для запуска в меню приложений на основной системе. Учтите, что это сработает только при наличии `.desktop` файла у программы!

`--bin` или `-b` используются для экспорта бинарных (двоичных) файлов. В команду следует передавать абсолютный путь до него.

`--export-path` или `-ep` принимают путь, куда следует экспортировать двоичный файл.

`--extra-flags` или `-ef` позволяют указать дополнительные флаги для программы, с которыми она будет запускаться.

`--delete` или `-d` применяются для удаления экспортированного приложения или двоичного файла из хост системы.

`--sudo` или `-S` указывают, что экспортированная программа должна запускаться через `sudo`.

Чтобы увидеть все экспортированные приложения и "бинарники", воспользуйтесь `--list-apps` и `--list-binaries` (при помощи `-ep` можно указать свои пути поиска) соответственно.
:::

## Источники

https://www.altlinux.org/Docker

https://stackoverflow.com/questions/47854463/docker-got-permission-denied-while-trying-to-connect-to-the-docker-daemon-socke

https://distrobox.it/
