# Проприетарный драйвер NVIDIA:

## Установка (Смена Nouveau драйверов на проприетарные)

### Способ 1. Через EPM

Для упрощения процесса установки проприетарного драйвера для графических карт NVIDIA можно использовать [интерфейс EPM](/package-manager/epm/).
Данный скрипт включает в себя **наиболее полную первоначальную настройку**, включая [активацию wayland](#сессия-wayland) и решение проблемы с [неизвестным монитором](#«неизвестныи-монитор»-в-настроиках-дисплеев-в-сессии-wayland). 

**Если необходима наиболее простая установка, используйте этот способ.**

Выполните следующую команду в терминале:
```shell
su -
epm play switch-to-nvidia
```

::: tip
Для корректной установки во время выполнения скрипта следует внимательно читать появляющиеся сообщения и в точности следовать им. Возможно, потребуется несколько перезагрузок. Например, для автоматического обновления ядра.
:::

После успешного завершения работы скрипта нужно перезагрузить операционную систему.

### Способ 2. Вручную

Для перехода с Nouveau на NVIDIA рекомендуется сначала обновить ядро:

```shell
su -
update-kernel
```
Для дальнейшей корректной установки проприетарных драйверов NVIDIA, **необходимо перезагрузить операционную систему**.

Установим проприетарный драйвер NVIDIA:

```shell
su -
rpm -e $(rpm -qf `modinfo -F filename nouveau`)
apt-get install nvidia_glx_common
nvidia-install-driver
make-initrd
```

::: danger
Не следует запускать фирменный инсталлятор драйвера NVIDIA из .run-файла!
:::

## Настройка драйверов

::: info
Настройки описаны, в первую очередь, для актуальных драйверов.

Перед началом настройки, сначала узнайте версию драйверов и ознакомьтесь с информацией, связанной с ними (См. блоки «Для драйверов XXX», где XXX это версия установленных у вас драйверов).
:::

Чтобы узнать версию драйверов, необходимо ввести:
```shell
inxi -G
```

## Настройка и информация для драйверов (550.54.14 и новее)

Настраиваем **Wayland** сессию в **ALT Regular KDE** для видеокарт NVIDIA с проприетарными драйверами.

::: info
При установке драйверов через [EPM](#способ-1-через-epm) настройка под wayland уже будет произведена. Если Вы использовали этот способ, дальнейшая настройка не требуется.
:::

::: warning
У драйверов NVIDIA существуют [известные проблемы и несовместимости](#проблемы-c-wayland-протоколом), связанные с wayland. Вы можете ознакомится с ними для лучшего понимания дел на данный момент.
:::

### Для работы wayland необходим [Kernel Mode Setting](https://www.kernel.org/doc/html/latest/gpu/drm-kms.html).
[Начиная с октября 2023 года](https://git.altlinux.org/tasks/archive/done/_324/332535/gears/100/git?p=git;a=commit;h=3bb30586e8c78e167a59f680370bad04fe50fadc), в ручной активации KMS нет необходимости. Правильная опция будет прописана вместе с установкой драйверов и будет находиться в /etc/modprobe.d/nvidia_common.conf.

::: tip
Чтобы проверить, работает ли KMS, напишите в терминале от пользователя root (Администратора):

'cat /sys/module/nvidia_drm/parameters/modeset'

Если консоль выводит «Y» значит работает.

Если не работает( показывает «N»), можете попробовать включить его через [параметры ядра](#не-работает-kms)
:::

### Для корректно работы сна или гибернизации в режиме wayland, необходимо правильное сохранение выделенных ресурсов видеопамяти.
Существует 2 способа как это сделать.[(см. источник)](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/powermanagement.html):

### 1 способ. Через сохранение выделенных ресурсов в безымянных временных файлах. 

Такой способ позволяет использовать глубокий уровень сна (S4 и S5), и не требует дополнительной поддержки S0ix.
::: warning
Существуют проблемы на некоторых устройствах с PRIME. Этот способ больше направлен на **настольные ПК**
:::

**Как включить:**

 Активируем интерфейсы управления питания NVIDIA:

```shell
su -
systemctl enable nvidia-suspend.service nvidia-resume.service nvidia-hibernate.service
```
::: tip
Эти интерфейсы заменяют стандартные sleep hibernate и resume, давая возможность записать ресурсы видеопамяти перед отключением питания у видеокарты.
:::

:::info
Если вы устанавливали проприетарный драйвер NVIDIA при помощи epm, то данная команда уже была выполнена автоматически.
:::

В опциях драйверов NVIDIA указываем о смене способа сохранения ресурсов видеопамяти и указываем куда:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_videomemory_allocation.conf
options nvidia NVreg_PreserveVideoMemoryAllocations=1
options nvidia NVreg_TemporaryFilePath=/var/tmp
_EOF_
make-initrd
```

::: info
Для сохранения ресурсов видеопамяти важно, чтобы файловая система имела поддержку безымянных временных файлов и имела достаточный объём для сохранения видеопамяти. Объём, равный сумме всей видеопамяти + 5% от неё, будет вполне достаточно для её сохранения.

Узнать количество видеопамяти можно командой: `nvidia-smi -q -d MEMORY |grep 'FB Memory Usage' -A1`

Также, во избежании нехватки места, следует избегать директорий с tmpfs в опции `NVreg_TemporaryFilePath`. (Таких как /tmp или /run.)
Однако с ними данная настройка тоже будет работать. Но все же лучше не эксперементировать и довериться рекомендациям от NVIDIA в лице /var/tmp.
:::

### 2 способ. Чере через режим сохранения питания [S0ix](https://ru.msi.com/blog/why-modern-standby-matters-for-business-laptop#:~:text=%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F%20Modern%20Standby%20%E2%80%93%20%D1%8D%D1%82%D0%BE,%D0%BE%D0%BD%D0%B0%20%D0%BF%D0%BE%D0%B7%D0%B2%D0%BE%D0%BB%D1%8F%D0%B5%D1%82%20%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D1%83%20%C2%AB%D0%BF%D1%80%D0%BE%D0%B1%D1%83%D0%B6%D0%B4%D0%B0%D1%82%D1%8C%D1%81%D1%8F%C2%BB%20%D0%BC%D0%BE%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE). 

Этот способ позволяет не выгружать видеопамять. Сам по себе режим S0ix, а следовательно и данный способ направлены **на переносные устройства**.

**Как включить:**

Проверяем, поддерживает ли система s2idle. Для этого выполните команду:

```shell
cat /sys/power/mem_sleep
```
::: tip
Если в выводе есть s2idle, значит s2idle поддерживается и проверяем видеочип. Если в выводе нет s2idle, тогда используйте 1 способ.
:::

Проверяем, поддерживает ли s0ix видеочип. Для этого выполните команду, перед этим подставив расположение вашего устройства(Посмотрите по каталогам после `/proc/driver/nvidia/gpus`. У каждого устройства своё значение).
:

```shell
grep 'Video Memory Self Refresh' /proc/driver/nvidia/gpus/<Domain>:<Bus>:<Device>.0/power
```
::: tip
Если ответ `Video Memory Self Refresh: is supported` значит s0ix поддерживает и можно проверять систему дальше. 
:::

Если система и видеочип поддерживают указанные режимы, добавляем параметр  `NVreg_EnableS0ixPowerManagement=1`:

```shell
su -
modprobe nvidia NVreg_EnableS0ixPowerManagement=1
```

Если при выводе `cat /sys/power/mem_sleep` **s2idle** не был в скобках (Вот так: **\[s2idle\]**), выполняем в консоли:

```shell
su -
echo "s2idle" > /sys/power/mem_sleep
```
После указания опции и режима , тестируем сон и проверяем, всё ли корректно загрузилось. Если всё хорошо, добавляем настройки на постоянную загрузку:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/enable_S0ix_power_management.conf
options nvidia NVreg_EnableS0ixPowerManagement=1
_EOF_
make-initrd
```
Если ранее приходилось вручную указывать s2idle, прописываем в параметр `GRUB_CMDLINE_LINUX_DEFAULT` значение `mem_sleep_default=s2idle` и генерируем новых grub.cfg:
```shell
su -
mcedit /etc/sysconfig/grub2
grub-mkconfig -o /boot/grub/grub.cfg
```

::: info
При переходе видеокарты в спящий режим S0ix, будет выполнятся один из 2-х сценариев:
- Если использование памяти было меньше определённого порога, видеопамять скопируется в системную память и полностью отключится вместе с графическим процессором
- Если использование памяти было больше определённого порога, видеопамять будет в режиме самообновления, в то время как остальная часть графического процессора будет отключена

По умолчанию, этот порог составляет 256 МБ, и его можно изменить с помощью параметра `NVreg_S0ixPowerManagementVideoMemoryThreshold`. Имейте ввиду, чем больше указан размер, тем выше вероятность, что часть видеопамяти не будет сохранена.
:::

---

## Настройка и информация для драйверов < 470.223.02

### Проблема с Intel:
Драйвер 470.223.02 и более ранние версии, начиная с Linux 5.18 могут работать неправильно в системах с процессорами Intel 11-го поколения и новее, из-за несовместимости с [Indirect Branch Tracking](https://edc.intel.com/content/www/us/en/design/ipla/software-development-platforms/client/platforms/alder-lake-desktop/12th-generation-intel-core-processors-datasheet-volume-1-of-2/007/indirect-branch-tracking/).
Можно отключить его, добавив значение `ibt=off` в параметр `GRUB_CMDLINE_LINUX_DEFAULT`:

```shell
su -
mcedit /etc/sysconfig/grub2
grub-mkconfig -o /boot/grub/grub.cfg
```

::: warning
Имейте в виду, что эта функция безопасности отвечает за [защиту от ряда методов эксплойта](https://lwn.net/Articles/889475/) .
:::

### Сессия Wayland

::: info
Драйвера до версии 495 имеют поддержку только **EGLStreams**. 

Kwin [удалила поддержку EGLStreams](https://invent.kde.org/plasma/kwin/-/merge_requests/1638). **Сессия Wayland на данном драйвере не поддерживается.**
:::

### Включение [Kernel Mode Setting](https://www.kernel.org/doc/html/latest/gpu/drm-kms.html).

Kernel Mode Setting необходимо указать вручную в параметрах ядра. Для этого необходимо прописать в параметр `GRUB_CMDLINE_LINUX_DEFAULT` значение `nvidia-drm.modeset=1` и cгенерировать новых grub.cfg:

```shell
su -
mcedit /etc/sysconfig/grub2
grub-mkconfig -o /boot/grub/grub.cfg
```

В остальном, информация актуальна как для [драйверов < 550.54.14](#настроика-и-информация-для-драиверов-550-54-14-и-новее)

## Настройка и информация для драйверов < 390.157

::: info
Драйверы NVIDIA до версии 470 не поддерживают аппаратное ускорение Xwayland.

Для драйверов до версии  ~400 NVDEC недоступен.
:::

В остальном, информация актуальна как для [драйверов < 470.223.02](#настроика-и-информация-для-драиверов-470-223-02)

## Настройка и информация для драйверов < 340.108
::: info
Драйверы до версии 364.12 **не имеют поддержку Kernel Mode Settings**.

Для драйверов до версии ~400 ускоренное декодирование видео NVDEC **недоступен**.
:::

В остальном, информация актуальна как для [драйверов < 390.157](#настроика-и-информация-для-драиверов-390-157)

## Настройка и информация для драйверов < 304.137

::: info
Для драйверов до версии 340.108 ускоренное декодирование видео VDPAU **недоступен**.
:::

В остальном, информация актуальна как для [драйверов < 340.108](#настроика-и-информация-для-драиверов-340-108)

## Полезные программы:
::: info
При установке драйверов через **EPM**, многие программы, скорее всего уже будут установлены.

Группа устанавливаемых пакетов, может постоянно менятся, поэтому для уточнения рекомендованно проверить сам [EPM скрипт](https://gitlab.eterfund.ru/etersoft/eepm/blob/master/prescription.d/switch-to-nvidia.sh)
:::

### NVIDIA Settings

Утилита для настройки и оптимизации графических параметров на компьютерах с видеокартами Nvidia. Она позволяет пользователям настраивать качество изображения, разрешение экрана, а также различные параметры, связанные с производительностью видеокарты. С помощью Nvidia Settings можно также включить или отключить определенные функции, такие как вертикальная синхронизация или сглаживание.

В зависимости от сессии Xorg или Wayland возможны различаться набор настроек в утилите NVIDIA Settings. Например, в Wayland нельзя настроить вертикальную синхронизацию и тройную буферизацию, так как они работают по-другому в этом окружении. Также в Wayland нет поддержки G-Sync, так как эта технология работает только с NVIDIA и требует специального оборудования. В целом, основные функции NVIDIA Settings доступны в обоих окружениях, но некоторые дополнительные возможности могут быть ограничены.

#### Установка из репозитория

**NVIDIA Settings** можно установить любым привычным и удобным способом:

**Установка через терминал**
::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-settings
```
```shell[epm]
epm -i nvidia-settings
```
:::


### EnvyControl

EnvyControl это утилита командной строки которая позволяет выбирать режим работы гибридной графики, на выбор представлено три режима

#### Гибридный режим 

 - Позволяет драйверу самому решать какой графический процессор использовать, обычно большую часть времени используется интегрированая графика, а дискретная графика работает только если она нужна, например в играх или программах для монтажа
 - Позволяет использовать RTD3, [подробнее](#управление-питанием-pci-express-runtime-d3-rtd3)
 - Работает только на видиокартах Turing и выше
 - Возможны проблемы с HDMI

 #### Интегрированный режим

 - Использует только интегрированную графику (Intel или AMD) отключая Nvidia
 - Мониторы подключенные к Nvidia работать не будут
 
#### Nvidia режим 

 - Используется исключительно видеокарта от Nvidia

#### Пара примеров

Установить интегрированный режим:

```shell
su-
envycontrol -s integrated
```

Установить гибридный режим и включить RTD3 (если ничего не указывать то значение будет равно двум):

```shell
su-
envycontrol -s hybrid --rtd3
```

Установить гибридный режим, включить ForceCompositionPipeline, а так же установить coolbits на 28 разрешая разгон видеокарты:
```shell
su-
envycontrol -s nvidia --force-comp --coolbits 24
```

**Установка через терминал**
::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install envycontrol
```
```shell[epm]
epm -i envycontrol
```
:::

После установки рекомедуем ввести комманду ```envycontrol --help``` что бы ознокомится со всеми возможностями утилиты.

### vulkan-tools

Программа vulkaninfo отображает информацию о поддерживаемых возможностях Vulkan для пользователей графических устройст NVIDIA. Необходимо установить пакет `vulkan-tools`:

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install vulkan-tools
```
```shell[epm]
epm -i vulkan-tools
```
:::

Для вывода информации `vulkaninfo` в терминале введите:

```shell
vulkaninfo --summary
```

### nvidia-vaapi-driver
Реализация VA-API, использующая NVDEC в качестве бэкенда. Эта реализация специально разработана для использования в Firefox для ускоренного декодирования веб-содержимого и может работать некорректно в других приложениях. Доп. информацию смотрите на [странице проекта](https://github.com/elFarto/nvidia-vaapi-driver)

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-vaapi-driver
```

### nvidia-modprobe
Утилита nvidia-modprobe используется компонентами драйверов NVIDIA в пользовательском пространстве
для проверки загрузки модуля ядра NVIDIA и наличия
файлов символьных устройств NVIDIA. Эти возможности обычно предоставляются
системами конфигурации дистрибутива GNU Linux, такими как udev. По возможности
рекомендуется использовать встроенные механизмы вашего дистрибутива GNU Linux
для управления загрузкой модулей ядра и созданием файлов устройств. Эта утилита
предоставляется в качестве запасного варианта для работы независимо от дистрибутива.

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-modprobe
```

### nvidia-cuda-toolkit
Этот пакет содержит библиотеки и сопутствующие файлы, необходимые для запуска
программ, использующих [CUDA](https://developer.nvidia.com/cuda-toolkit).

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-cuda-toolkit
```

### nvidia-xconfig
nvidia-xconfig - это инструмент, предназначенный для обеспечения базового управления по параметрам конфигурации, доступным в драйвере NVIDIA X11.

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-xconfig
```

## Дополнительные настройки

### Управление питанием PCI-Express Runtime D3 (RTD3)
Драйвер NVIDIA имеют поддержку динамического управления питанием графического процессора NVIDIA ([PCI-Express Runtime D3 (RTD3) Power Management]().

В это управление входит регулирование тактовой частоты, напряжение на разных участках микросхемы, а также, в некоторых случаях, полное отключение тактовой частоты или питания элементов чипа.

И всё это не влияя на функциональность, позволяя работать графическому процессору с меньшей производительностью, но с более низким потреблением энергии.

Для работы RTD3 необходимо следующее:
- Ноутбук
- Процессор из cерия чипсетов Coffeelake или новее
- Видеокарта архитектуры Turing или новее
- Linux ядро версии 4.18 и новее
- Ядро Linux собрано с CONFIG_PM (CONFIG_PM=y). Как правило, если система поддерживает S3 (suspend-to-RAM), то и CONFIG_PM будет определён как надо

::: info
Для Ampere или более поздних версий видеокарт, **RTD3 включено по умолчанию. Настройка не нужна.**

Для видеокарт Turing настройка должна быть включена вручную:
:::

Для автоматизации управления надо добавить правила в '/lib/udev/rules.d':
```shell
su -
cat << _EOF_ > /lib/udev/rules.d/80-nvidia-pm
# Enable runtime PM for NVIDIA VGA/3D controller devices on driver bind
ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="auto"
ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="auto"

# Disable runtime PM for NVIDIA VGA/3D controller devices on driver unbind
ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="on"
ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="on"
_EOF_
make-initrd
```

В /etc/modprobe.d добавляем конфигурационный файл с параметром:
```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_RTD3.conf
# This options activate RTD3
options nvidia "NVreg_DynamicPowerManagement=0x02"
_EOF_
make-initrd
```

::: info
Более подробное описание работы, а также решение возможных проблем смотрите в [документации NVIDIA](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/dynamicpowermanagement.html).
:::

### PAT

Драйвер NVIDIA позволяет сменить старый атрибут страничной организации памяти [MTRR на PAT](https://wiki.gentoo.org/wiki/MTRR_and_PAT).

[PAT](https://docs.kernel.org/arch/x86/pat.html) более современная технология и является более гибким атрибутом, добавляя новые возможности для организации памяти.

Чтобы её включить, в /etc/modprobe.d добавляем конфигурационный файл с параметром:
```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_PAT.conf
# This options activate PAT
options nvidia NVreg_UsePageAttributeTable=1
_EOF_
make-initrd
```
::: warning
Удостоверьтесть, что ваша система поддерживает PAT, а в противном случае, у вас могут быть проблемы с системой.
:::

Проверка поддержки PAT:

```shell
su -
cat /proc/cpuinfo | grep pat
```

### GSP прошивка

Некоторые видеокарты имеют GSP процессор, который может использоваться для разгрузки задач и управления графическим процессором. По умолчанию, он включён для ограниченного числа видеокарт.
Тем не менее, начиная с архитектуры Turing, этот процессор присутствует во всех видеокартах и его можно принудительно включить(Подробнее см. [GSP firmware](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/gsp.html))

В /etc/modprobe.d добавляем конфигурационный файл с параметром:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_GSP_firmware.conf
# This options force unlock GPU firmware
options nvidia NVreg_EnableGpuFirmware=1
_EOF_
make-initrd
```

### Фреймбуфер от NVIDIA

Начиная с драйверов версии 545.29, можно включить фреймбуффер предусмотренный nvidia-drm. Он заменяет стандартные фреймбуферы, такие как efifb или vesafb. 
Для работы, необходимо, чтобы работал [KMS](#kms)

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia-framebuffer.conf
# This options unlock experimental nvidia framebuffer
options nvidia_drm fbdev=1
_EOF_
```

::: danger
Это экспериментальная функция и работает нестабильно.
:::

## Решение известных проблем

### «Неизвестный монитор» в настройках дисплеев в сессии Wayland
:::info
Данная проблема может привести к некорректной работе устройств ввода: мышка, тачпад. Особенно часто данные проблемы проявляются в играх.
:::
**На данный момент существует 3 способа устранения фантомного монитора**
1. Использование собственного фреймбуфера от NVIDIA:
   Необходимо добавить опцию [fbdev=1 в /etc/modprobe.d/](#фреимбуфер-от-nvidia)

2. Отключение загрузки simpledrm:
Внесем изменение в конфигурацию **GRUB**:
```shell
su -
mcedit /etc/sysconfig/grub2
```

Добавляем в параметр `GRUB_CMDLINE_LINUX_DEFAULT` значение `initcall_blacklist=simpledrm_platform_driver_init` и генерируем grub.cfg.
```shell
su -
grub-mkconfig -o /boot/grub/grub.cfg
```

:::warning
Данное решение приводит к невозможности входа в tty, к отсутствию вывода логов во время загрузки (Если не включён Plymouth с заставкой, закрывающий эту загрузку), и к чёрному экрану, если система, по какой-то причине не запустилась вовсе.

Если у вас после загрузки чёрный экран, либо необходимо проинспектировать запуск, **уберите это значение из параметров ядра на этапе загрузки grub**. Также, для решения проблем, Вам, возможно, будет полезно убрать параметр **quiet** для вывода более подробных логов, и **splash** для отключения заставки во время вывода логов.
:::

:::info
При использовании epm, данный способ будет применен автоматически.
:::

3. Откройте приложение "Параметры системы KDE5", перейдите во вкладку "Экран", в опции "Настройка экранов" выберите экран "Unknown" в параметре "Устройство" и отключите его, убрав галочку с параметра "Включен".

### В сессии Wayland панель задач "зависает" (Plasma 5.7): 
Необходимо отключить "миниатюры окон" в настройках панели задач (Plasma/Tasks)
Для этого необоходимо снять галочку с **Показывать миниатюру окна принаведении указателя мыши на элемент в панели задач**.

Для этого щёлкните правой кнопкой мыши и выберите **"настроить виджет«Панель задач»"  -> "Внешний вид" -> "Показывать миниатюру окна принаведении указателя мыши на элемент в панели задач"**

::: info
Проблема наблюдается только на Plasma 5.x и затрагивает также владельцев AMD.
Подробнее об ошибке: https://bugs.kde.org/show_bug.cgi?id=469016

P.S: В KDE Plasma 6 данную проблему уже решили.
:::

### Не работает KMS
Если при загрузке системы чёрный экран, либо при проверке 'cat /sys/module/nvidia_drm/parameters/modeset' выводит 'N', можно попробовать прописать в параметр `GRUB_CMDLINE_LINUX_DEFAULT` значение `nvidia-drm.modeset=1` и cгенерировать новых grub.cfg:

```shell
su -
mcedit /etc/sysconfig/grub2
grub-mkconfig -o /boot/grub/grub.cfg
```
### Если при установке или первом запуске чёрный экран, артефакты или другие проблемы
Если при первом же включении или установке появляются проблемы с отображением картинки, можно попробовать сменить режим вывода графики.

Для этого необходимо на этапе выбора вариантов загрузки в [Grub](https://en.wikipedia.org/wiki/GNU_GRUB) нажать кнопку <<**e**>> и дописать одни из следующих параметров:

- **nomodeset** — не загружать видеодрайверы для видеокарты до момента, пока не будет загружена графическая система X. В результате система загружается в текстовом виде, можно видеть сообщения процесса загрузки, проблема «черного экрана загрузки» устраняется;
- **xdriver** — графический установщик предпринимает попытку автоматического подбора драйвера видеокарты, но иногда это ему не удаётся. Данным параметром можно отключить «искусственный интеллект» и явно указать нужный вариант драйвера;
- **instdebug** — если будет присутствовать этот параметр, то перед запуском и после завершения работы графического установщика будет запущена командная оболочка (shell). Это очень полезное средство для выявления причин отсутствия запуска графической части программы установки. Последовательность работы внутренних сценариев следующая: install2 → xinit → alterator-install2 → alterator-wizard. При необходимости можно вручную загрузить Xorg (команда xinit) и в открывшемся окне терминала запустить alterator-install2 (или alterator-wizard) вручную. Лог-файлы инсталлятора сохраняются в /tmp.
xdriver — отключает автоопределение и принудительно загружает указанный драйвер; можно указать любой драйвер, поддерживаемый xorg. Например, i915, nvidia, radeon, fglrx и т.д.

Существуют универсальные видеодрайверы:

- **vesa** — минимальный драйвер, работает в общем так же, как и любой другой, но ожидает не конкретной видеокарты, а пытается следовать стандартам VESA (многие видеокарты его нормально поддерживают). Этот драйвер умеет только выводить изображение без ускорения и прочих «излишеств», достаточно медленно работает.
- **fbdev** — ещё более «тупой» драйвер. Он передаёт команду связаться с ядром и пытается рисовать картинку через него. Под этим драйвером может оказаться со стороны ядра несколько разных драйверов, но чаще всего это опять же VESA, но особая, ядерная версия. Работает часто это ещё медленнее, но практически всегда. И современная тенденция такова, что пытаются увеличить возможности и быстродействие ядерного модуля.

::: info
Всё описание взято отсюда: [Altlinux: проблемы с драйвером видеокарты](https://www.altlinux.org/#Проблемы_с_драйвером_видеокарты)
:::

### Прочие решения известных проблемы

Также, другие проблемы и возможные их решения, вы можете найти в [главе 8 документации NVIDIA](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/commonproblems.html)


## Известные нерешённые проблемы

В [главе 9 документации NVIDIA](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/knownissues.html) можно ознакомиться с известными нерешёнными проблемами у драйверов NVIDIA

### Проблемы c Wayland протоколом

У NVIDIA c wayland существуют нерешённые проблемы. Вы можете ознакомится с ними в [приложении L документации NVIDIA](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/wayland-issues.html)

## Данные об оборудовании и ПО пользователей за 2024 год.

Ознакомиться с таблецей вы можете перейдя [по ссылке](https://cloud.alt-gnome.ru/index.php/s/JSCj9gxB7j5boPg)

### Источники:
https://www.altlinux.org/Nvidia

https://www.kernel.org/doc/html/latest/gpu/drm-kms.html

https://wiki.gentoo.org/wiki/NVIDIA/nvidia-drivers/ru


https://www.altlinux.org/#Проблемы_с_драйвером_видеокарты

https://bugzilla.altlinux.org/39108

https://packages.altlinux.org/ru/sisyphus/srpms/nvidia_glx_common/

https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/powermanagement.html

https://wiki.archlinux.org/title/NVIDIA

https://wiki.archlinux.org/title/NVIDIA/Tips_and_tricks

https://wiki.archlinux.org/title/Kernel_mode_setting

https://wiki.gentoo.org/wiki/NVIDIA/nvidia-drivers
